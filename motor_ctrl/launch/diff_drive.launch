<launch>
    <include file="$(find motor_ctrl)/launch/motor_ctrl.launch" />
    <!-- <include file="$(find motor_ctrl)/launch/encoder.launch" /> -->

    <!-- ENCODER -->
    <node pkg="motor_ctrl" type="encoder" name="encoder" ns="/encoder" output="screen"> </node>

    <arg name="left_kp" default="1"/>
    <arg name="left_ki" default="0"/>
    <arg name="left_kd" default="0"/>

    <arg name="right_kp" default="1"/>
    <arg name="right_ki" default="0"/>
    <arg name="right_kd" default="0"/>

    <arg name="rate" default="10" />

    <rosparam param="ticks_meter">3526</rosparam>

    <node pkg="rostopic" type="rostopic" name="rostopic_left" args="pub /teleop/lwheel_vtarget std_msgs/Float32 0.0"/>
    <node pkg="rostopic" type="rostopic" name="rostopic_right" args="pub /teleop/rwheel_vtarget std_msgs/Float32 0.0"/>

    <!-- PID MOTOR CONTROL -->
    <node pkg="differential_drive" type="pid_velocity.py" name="pid_left" ns="/motor/left" output="screen">
        <param name="Kp" value="$(arg left_kp)" />
        <param name="Ki" value="$(arg left_ki)" />
        <param name="Kd" value="$(arg left_kd)" />
        <param name="rate" value="$(arg rate)" />
        <param name="vel_threshold" value="1.0" />
        <remap from="wheel" to="/encoder/left" />
        <remap from="wheel_vtarget" to="/teleop/lwheel_vtarget" />
    </node>
    <node pkg="differential_drive" type="pid_velocity.py" name="pid_right" ns="/motor/right" output="screen">
        <param name="Kp" value="$(arg right_kp)" />
        <param name="Ki" value="$(arg right_ki)" />
        <param name="Kd" value="$(arg right_kd)" />
        <param name="rate" value="$(arg rate)" />
        <param name="vel_threshold" value="1" />
        <remap from="wheel" to="/encoder/right" />
        <remap from="wheel_vtarget" to="/teleop/rwheel_vtarget" />
    </node>

    <node pkg="differential_drive" type="diff_tf.py" name="diff_tf" ns="/motor" output="screen">
        <param name="rate" value="$(arg rate)" />
        <param name="base_width" value="0.16" />
        <remap from="lwheel" to="/encoder/left" />
        <remap from="rwheel" to="/encoder/right" />
    </node>

    <node pkg="differential_drive" type="twist_to_motors.py" name="twist_to_motors" ns="/teleop" output="screen">
        <param name="base_width" value="0.16" />
        <param name="rate" value="$(arg rate)" />
    </node>

    <node pkg="differential_drive" type="virtual_joystick.py" name="virtual_joystick" ns="/teleop" output="screen">
        <param name="x_min" value="-10" />
        <param name="x_max" value="10" />
        <param name="r_min" value="-3" />
        <param name="r_max" value="3" />
        <param name="publish_rate" value="$(arg rate)" />
    </node>

</launch>
